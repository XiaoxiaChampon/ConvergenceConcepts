---
title: "Convergence Concepts with Shiny"
author: "Xiaoxia Champon, Justin Post"
date: "2023-04-25"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE,warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```




```{r include=FALSE,warning=FALSE}
#add library
library(shiny)
library(shinydashboard)
library(ConvergenceConcepts)
```

# Convergence Concepts
The convergence of random variables is important for asymptotic inference. As we can never collect infinity number of data, asymptotic result is critical to approximate the distribution of statistics of interest with finite sample size. We will discuss the most common three types of convergence.

Notation:

* Let $X_1,X_2,\cdots,X_n$ be a sequence of iid random variables and $X$ be a random variable such that $E(X_i)=\mu, Var(X_i)=\sigma^2 < \infty, \forall i$
  * Convergence in distirbution $X_n\stackrel{d}{\rightarrow} X$
  * Convergence in probability $X_n\stackrel{p}{\rightarrow} X$
  * Convergence almost surely $X_n\stackrel{a.s.}{\rightarrow} X$








:::: {style="display: flex;"}

::: {}

## Convergence in Distribution
* Definition $lim_{n \rightarrow \infty} F_{X_n}(x)=F_{X}(x)$, or
            $lim_{n \rightarrow \infty} |F_{X_n}(x)-F_{X}(x)|=0$
  * $F_X(x)$ is continuous
  * Cumulative Density Function (CDF)


![](/Users/xzhao17/Desktop/convergence/cid2.png) 
:::

::: {}


## Central Limit Theorem
Define $\overline{X}=\frac{1}{n} \sum_{i=1}^{n} X_i$ such that $E(X_i)=\mu, Var(X_i)=\sigma^2 < \infty, \forall i$ and $X \sim N (0, 1)$

* $\frac{\sqrt{n} (\overline{X_n}-\mu)}{\sigma} \stackrel {d} {\rightarrow} X$




![](/Users/xzhao17/Desktop/convergence/cid.png) 
:::

::::




## R shiny demonstration by the instructor

### This section illustrates convergence in distribution

#### "\\(\\star\\)By definition, \\(X_n \\overset{d} {\\to} X\\) or \\(X_n \\overset{L} {\\to} X\\) if and only if \\(l_n= \\lvert F_{X_n}(t)-F_X(t) \\rvert \\underset{n\\to \\infty} \\rightarrow  0\\) for all \\(t\\) and \\(F_X(x)\\) is continuous. "

#### "\\(\\star\\) \\(\\widehat l_n(t)=\\lvert \\widehat F_{X_n}(t)-F_X(t) \\rvert\\) is used for convergence in distribution. \\(F_X(t)\\) is the cumulative distribution function of \\(X\\) and \\(\\widehat F_{X_n} (t)\\) is the empirical distribution function of \\(X_n\\) such that  \\(\\widehat F_{X_n} (t)=\\frac{\\# \\{x_n^{j} \\leq t \\}}{M}, \forall j =1,\\cdots, M\\)."






```{r eruptions, echo=FALSE}
sidebarPanel(
      
                      sliderInput("d_n",
                                  "n: the nth element in the sequence",
                                  min = 1,
                                  max = 1000,
                                  step=50,
                                  value = 100,
                                  animate=animationOptions(
                                  interval = 1000,
                                  loop = TRUE,
                                  playButton = "Play",
                                  pauseButton = "Stop")    
                                  ),
                    
                      helpText("As \\(n\\) increases,"),
                      helpText("\\(\\star\\) More points will be created in each sequence and the density plot will vary"),
                      

#########
                      
                    
                        sliderInput("d_ns",
                                    "M: the number of simulations of the sequence",
                                    min = 1,
                                    max = 2000,
                                    step=30,
                                    value = 50,
                                  animate=animationOptions(
                                  interval = 1000,
                                  loop = TRUE,
                                  playButton = "Play",
                                  pauseButton = "Stop")) ,
                      
                        
                        helpText("As \\(M\\) increases,"),
                        helpText("\\(\\star\\) The 3-D plot of \\(\\widehat l_n(t)=\\lvert \\widehat F_{X_n}(t)-F_X(t) \\rvert\\) will get closer to zero horizontal plane"),
                        helpText("\\(\\star\\)  \\(X_n \\overset{d} {\\to} X\\sim N(0,1)\\)"),
                        
      #####
                    
                          sliderInput("d_k",
                                      helpText("\\(K\\)=position of \\(X_n\\) and \\(K\\leq n_{max}\\)"),
                                      min = 1,
                                      max = 1000,
                                      step=1,
                                      value = 10,
                                  animate=animationOptions(
                                  interval = 1000,
                                  loop = TRUE,
                                  playButton = "Play",
                                  pauseButton = "Stop")),
                          helpText("As \\(K\\) increases,"),
                          helpText("\\(\\star\\) Density plot of \\(X_n\\) values will resemble a standard normal curve"),
                          helpText("\\(\\star\\) \\(\\widehat F_{X_n}(t)\\) will approach to \\(F_X(t)\\) ")
                      
)

############
mainPanel(
                          helpText(h4('Let \\(Y_1, Y_2,....,Y_n\\) be independent random variables \\(Y\\sim \\chi_1^2\\), \\(Xn=\\frac {\\sum Y_i-n}{\\sqrt{2*n}} \\) and \\(X\\sim N(0,1)\\).')),
                      
                      helpText(h4("\\(F_{X_n}(t)\\) is the empirical distribution of \\(X_n\\) and \\(F_X(t)\\) is cdf of \\(X\\). We use \\(\\widehat F_{X_n} (t)\\) to approximate \\(F_{X_n}(t)\\). ")),
   
                      
                      
 
                  
####
#  splitLayout(plotOutput("d_hist"),
#               plotOutput("d_3D")
#   ),
# 
# 
# splitLayout(plotOutput("d_F"),
#               plotOutput("d_sp"))


                        
# d_hist=
splitLayout(

renderPlot({
      set.seed(1)
      d_n=input$d_n
      d_ns=input$d_ns
      d_k=input$d_k
      d_f=function(d_n){(cumsum(rchisq(d_n,df=1))-(1:d_n))/sqrt(2*(1:d_n))}
      d_data=data.frame()
      for (s in 1:d_ns){
        d_data=rbind(d_data,d_f(d_n))
      }
      d_h=hist(data.matrix(d_data[d_k]),main=mtext(bquote(bold("Density plot of"~X[n]~"values")),col="darkblue"),xlab="Xn values",col="green",border = "red",prob = T, xlim = c(-4,4))
     
      lines(seq(-4,4,length=d_ns),dnorm(seq(-4,4,length=d_ns)),col="darkblue",lwd=3)
      
      legend('topleft', c(expression(hat(f[X[n]](t))),expression(f[X](t))),
             fill =c("green", "darkblue"))
      
      text(x=4,y=max(d_h$density),bquote(bold(f[X[n]](t)~"will resemble"~f[X](t))),col="red",adj=1)
    }),
#d_hist
#######
#d_3D=renderPlot({
renderPlot({
      set.seed(1)
      d_n=input$d_n
      d_ns=input$d_ns
        
      d_f=function(d_n){(cumsum(rchisq(d_n,df=1))-(1:d_n))/sqrt(2*(1:d_n))}
        d_data_3D <- generate(randomgen=d_f,nmax=d_n,M=d_ns)$data
        law.plot3d(d_data_3D,pnorm)
    })
 #d_3D 
###########
  
  

),
####################
splitLayout(
 # d_F=renderPlot({
     renderPlot({
      set.seed(1)

      d_n=input$d_n
      d_ns=input$d_ns
      d_k=input$d_k
      d_f=function(d_n){(cumsum(rchisq(d_n,df=1))-(1:d_n))/sqrt(2*(1:d_n))}
      d_data=data.frame()
      for (s in 1:d_ns){
        d_data=rbind(d_data,d_f(d_n))
      }
      d_h=hist(data.matrix(d_data[d_k]),main=mtext(bquote(bold(.(d_ns)~"sample paths of"~X[n]~"values")),col="darkblue"),xlab="Xn values",col="green",border = "red",xlim = c(-4,4),prob=T,breaks = d_ns)

      d_y=d_h$density
      d_x=seq(-4,4,length.out =length(d_y))

      plot(d_x,cumsum(d_y)/max(cumsum(d_y)),type="l",lwd=2,main=mtext(bquote(bold(hat(F[X[n]](t))~"and"~F[X](t))),col="darkblue"),col="green",xlim=c(-4,4),xlab = "X", ylab = "Cumulative probability" )
      lines(d_x,pnorm(d_x),col="darkblue")
      legend('topleft', c(expression(hat(F[X[n]](t))),expression(F[X](t))),lty = c(1,1),col = c("green", "darkblue") )
             #fill =c("green", "darkblue"))

      text(x=4,y=0.05,bquote(bold(F[X[n]](t)~"will resemble"~F[X](t))),col="red",adj=1)
    }),
   #d_F
    ####
    #d_sp=renderPlot({
      renderPlot({
      set.seed(1)
      d_n=input$d_n
      d_ns=input$d_ns
        #eps2=input$ep2
      d_f=function(d_n){(cumsum(rchisq(d_n,df=1))-(1:d_n))/sqrt(2*(1:d_n))}
      d_data_3D <- generate(randomgen=d_f,nmax=d_n,M=d_ns)$data
        visualize.sp(d_data_3D,nb.sp=d_ns,epsilon=3,main=mtext(bquote(bold(.(d_ns)~"sample paths of"~X[n]~"values")),col="darkblue"), col="grey")
    })
#d_sp


)

)


```










## Your Turn

```{r  echo=FALSE}
sidebarPanel(
sliderInput("clt_n",
                                  "n: the nth element in the sequence",
                                  min = 10,
                                  max = 1000,
                                  step=5,
                                  value = 100,
                                  animate=animationOptions(
                                  interval = 1000,
                                  loop = TRUE,
                                  playButton = "Play",
                                  pauseButton = "Stop")),
                      
                      
                      
                      helpText("As \\(n\\) increases,"),
                      helpText("\\(\\star\\) More points will be created in each sample path and the density plot will vary"),
                      
####
sliderInput("clt_ns",
                                    "M: the number of simulations of the sequence",
                                    min = 1,
                                    max = 2000,
                                    step=5,
                                    value = 50,
                                  animate=animationOptions(
                                  interval = 1000,
                                  loop = TRUE,
                                  playButton = "Play",
                                  pauseButton = "Stop")),
                      
                      helpText("As \\(M\\) increases,"),
                      helpText("\\(\\star\\) The 3-D plot of \\(\\widehat l_n(t)=\\lvert \\widehat F_{X_n}(t)-F_X(t) \\rvert\\) will get closer to zero horizontal plane"),
                      helpText("\\(\\star\\)  \\(X_n \\overset{d} {\\to} X\\sim N(0,1)\\)"),
############
sliderInput("clt_k",
                                      helpText("\\(K\\)=position of \\(X_n\\) and \\(K\\leq n_{max}\\)"),
                                      min = 1,
                                      max = 1000,
                                      step=1,
                                      value = 10,
                                  animate=animationOptions(
                                  interval = 1000,
                                  loop = TRUE,
                                  playButton = "Play",
                                  pauseButton = "Stop")),
                          helpText("As \\(K\\) increases,"),
                          helpText("\\(\\star\\) Density plot of \\(X_n\\) values will resemble a standard normal curve"),
                          helpText("\\(\\star\\) \\(\\widehat F_{Xn}(t)\\) will approach to \\(F_X(t)\\)"),
#####
sliderInput("clt_alpha",
                                    helpText("\\(\\alpha\\)=shape parameter"),
                                    min = 0.0001,
                                    max = 10,
                                    step=0.1,
                                    value = 2,
                                  animate=animationOptions(
                                  interval = 1000,
                                  loop = TRUE,
                                  playButton = "Play",
                                  pauseButton = "Stop")),
                    
                      
                      helpText("\\(\\star\\) As \\(\\alpha\\) increases, the histogram will be more symmetric "),
#######
sliderInput("clt_beta",
                                    helpText("\\(\\beta\\)=scale parameter"),
                                    min = 0.0001,
                                    max = 10,
                                    step=0.1,
                                    value = 1,
                                  animate=animationOptions(
                                  interval = 1000,
                                  loop = TRUE,
                                  playButton = "Play",
                                  pauseButton = "Stop")),
                        
                        helpText("\\(\\star\\) As \\(\\beta\\) increases, the histogram will spread out more  ")
)
#######
mainPanel(
helpText(h4("This app is designed to visualize \\(X_n=\\frac{\\sqrt{n} ( \\overline Y_i-\\mu)  )}{\\sigma} \\overset {d}{\\to} X\\sim N(0,1) \\; or\\; X_n=\\frac{\\sqrt{n} ( \\overline Y_i-\\mu)  )}{\\sigma} \\overset {L}{\\to} X\\sim N(0,1) \\).")),
                      helpText(h4('Let \\(Y_1, Y_2,....,Y_n\\) be independent random variables \\(Y\\sim Gamma(\\alpha,\\beta)\\) and \\(Xn=\\frac{\\sqrt{n}*(\\overline Y_i-\\alpha*\\beta)}{\\sqrt{\\alpha*\\beta^2}}\\).')),
                      helpText(h4("\\(F_{X_n}(t)\\) is the empirical distribution of \\(X_n\\) and \\(F_X(t)\\) is cdf of \\(X\\). We use \\(\\widehat F_{X_n} (t)\\) to approximate \\(F_{X_n}(t)\\).  ")),


splitLayout(
  #clt_hist <- renderPlot({
    renderPlot({
      set.seed(1)
        clt_n=input$clt_n
        clt_ns=input$clt_ns
        clt_alpha=input$clt_alpha
        clt_beta=input$clt_beta
        clt_k=input$clt_k
        clt_f=function(clt_n){sqrt(1:clt_n)*(cumsum(rgamma(clt_n,shape=clt_alpha,scale=clt_beta))/(1:clt_n)-clt_alpha*clt_beta)/sqrt(clt_alpha*(clt_beta**2))}
        
        clt_data=data.frame()
        
        for (t in 1:clt_ns){
          clt_data=rbind(clt_data,clt_f(clt_n))
        }
        clt_h=hist(data.matrix(clt_data[clt_k]),main=mtext(bquote(bold("Density plot of"~X[n]~"values")),col="darkblue"),xlab="Xn values",col="green",border = "red",xlim = c(-4,4),prob=T)
        
        lines(seq(-4,4,length=length(clt_h$density)),dnorm(seq(-4,4,length=length(clt_h$density))),col="darkblue",lwd=3)
        
        legend('topleft', c(expression(hat(f[X[n]](t))),expression(f[X](t))),
               fill =c("green", "darkblue"))
        
        text(x=4,y=max(clt_h$density),bquote(bold(f[X[n]](t)~"will resemble"~f[X](t))),col="red",adj=1)
        
        
        }),
    
                      #clt_hist
    
    #clt_3D <- renderPlot({
       renderPlot({
      set.seed(1)
      clt_n=input$clt_n
      clt_ns=input$clt_ns
      clt_alpha=input$clt_alpha
      clt_beta=input$clt_beta
      clt_f=function(clt_n){sqrt(1:clt_n)*(cumsum(rgamma(clt_n,shape=clt_alpha,scale=clt_beta))/(1:clt_n)-clt_alpha*clt_beta)/sqrt(clt_alpha*(clt_beta**2))}
      
      clt_data_3D=data.frame()
      for (t in 1:clt_ns){
        clt_data_3D=rbind(clt_data_3D,clt_f(clt_n))
      }
      law.plot3d(data.matrix(clt_data_3D),pnorm)
    })
#clt_3D
  
),

splitLayout(
  ###
#clt_F <- renderPlot({ 
  renderPlot({ 
      set.seed(1)
      clt_n=input$clt_n
      clt_ns=input$clt_ns
      clt_alpha=input$clt_alpha
      clt_beta=input$clt_beta
      clt_k=input$clt_k
      clt_f=function(clt_n){sqrt(1:clt_n)*(cumsum(rgamma(clt_n,shape=clt_alpha,scale=clt_beta))/(1:clt_n)-clt_alpha*clt_beta)/sqrt(clt_alpha*(clt_beta**2))}
      
      clt_data=data.frame()
      
      for (t in 1:clt_ns){
        clt_data=rbind(clt_data,clt_f(clt_n))
      }
      clt_h=hist(data.matrix(clt_data[clt_k]),main=mtext(bquote(bold("Density plot of"~X[n]~"values")),col="darkblue"),xlab="Xn values",col="green",border = "red",xlim = c(-4,4),prob=T,breaks = clt_ns)
      clt_y=clt_h$density
      clt_x=seq(-4,4,length=length(clt_y))
      
      plot(clt_x,cumsum(clt_y)/max(cumsum(clt_y)),type="l",lwd=2,col="green",main=mtext(bquote(bold(hat(F[X[n]](t))~"and"~F[X](t))),col="darkblue"), xlim=c(-4,4),xlab = "X", ylab = "Cumulative probability")
      lines(clt_x,pnorm(clt_x),col="darkblue")
      legend('topleft', c(expression(hat(F[X[n]](t))),expression(F[X](t))),lty = c(1,1),col = c("green", "darkblue") )
            # fill =c("green", "darkblue"))
      
      text(x=4,y=0.1,bquote(bold(F[X[n]](t)~"will resemble"~F[X](t))),col="red",adj=1)
    }),
#clt_F
  
#####
#clt_sp <- renderPlot({
renderPlot({
      set.seed(1)
      clt_n=input$clt_n
      clt_ns=input$clt_ns
      clt_alpha=input$clt_alpha
      clt_beta=input$clt_beta
        #eps3=input$ep3
      clt_f=function(clt_n){sqrt(1:clt_n)*(cumsum(rgamma(clt_n,shape=clt_alpha,scale=clt_beta))/(1:clt_n)-clt_alpha*clt_beta)/sqrt(clt_alpha*(clt_beta**2))}
        clt_data_3D=data.frame()
        for (t in 1:clt_ns){
          clt_data_3D=rbind(clt_data_3D,clt_f(clt_n))
        }
        visualize.sp(data.matrix(clt_data_3D),nb.sp=clt_ns,epsilon=3,main=mtext(bquote(bold(.(clt_ns)~"sample paths of"~X[n])),col="darkblue"), col="grey")
        
    })
#clt_sp

)

)




```



<div class = "clearfix"> </div>

### Homework practice
Let $X_2, X_3,  X_4, \cdots $ be a sequence of random variable such that
$$F_{X_n}(x)=\begin{cases}
      1-(1-\frac{1}{n})^{nx} \ , \  x>0
      \\
      0 \ \ \ \ \ \ \ \ \ \ \ \ \ , \ otherwise
    \end{cases}    $$
Show that $X_n$ converges in distribution to Exponential(1).


Solution: Let $X \sim Exponential (1)$. For $x \leq 0$, we have
$$F_{X_n}(x)=F_x(x)=0,$$ for $n=2,3,4,\cdots$.
For $x \geq 0$, we have 
$$ \begin{aligned} lim_{n \rightarrow \infty} F_{X_n}(x)&=lim_{n \rightarrow \infty} (1-(1-\frac{1}{n})^{nx}) \\
&=1-lim_{n\rightarrow \infty} (1-\frac{1}{n})^{nx} \\
&=1-e^{-x}\\
&=F_X(x)\end{aligned}$$, for all $x$.
Thus, we conclude that $X_n \stackrel {d}{\rightarrow}X$.








## Embedded Application

It's also possible to embed an entire Shiny application within an R Markdown document using the `shinyAppDir` function. This example embeds a Shiny application located in another directory:

```{r tabsets, echo=FALSE}
shinyAppDir(
  system.file("examples/06_tabsets", package = "shiny"),
  options = list(
    width = "100%", height = 550
  )
)

```

Note the use of the `height` parameter to determine how much vertical space the embedded application should occupy.

You can also use the `shinyApp` function to define an application inline rather then in an external directory.

In all of R code chunks above the `echo = FALSE` attribute is used. This is to prevent the R code within the chunk from rendering in the document alongside the Shiny components.



